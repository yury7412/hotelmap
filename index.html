<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Гостиницы Самарской области</title>
    <style>
        #map {
            width: 100%;
            height: 600px;
        }
        .hotel-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .hotel-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .hotel-item:hover {
            background-color: #f5f5f5;
            cursor: pointer;
        }
        .container {
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .controls {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Гостиницы Самарской области</h1>
        <div class="controls">
            <button id="findHotels">Найти гостиницы</button>
            <span id="status"></span>
        </div>
        <div id="map"></div>
        <div class="hotel-list" id="hotelList"></div>
    </div>
    <!-- Замените YOUR_API_KEY на ваш действительный ключ -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=d3b3d20b-6c57-4626-b184-69cda98f0559&suggest_apikey=0d3aa57b-7df0-49af-a363-3a7b72745602&lang=ru_RU"
    type="text/javascript"></script>
    <script>
        // Инициализация карты
        ymaps.ready(init);
        
        let map;
        let objectManager;
        
        function init() {
            try {
                // Создаем карту
                map = new ymaps.Map("map", {
                    center: [53.195873, 50.100202], // Самара
                    zoom: 10
                });
                
                // Создаем менеджер объектов
                objectManager = new ymaps.ObjectManager({
                    clusterize: true,
                    gridSize: 32,
                    clusterDisableClickZoom: true
                });
                
                map.geoObjects.add(objectManager);
                
                document.getElementById('findHotels').addEventListener('click', findHotels);
            } catch (error) {
                document.getElementById('status').textContent = "Ошибка при загрузке карты: " + error.message;
            }
        }
        
        function findHotels() {
            const statusElement = document.getElementById('status');
            statusElement.textContent = "Ищем гостиницы...";
            
            objectManager.removeAll();
            document.getElementById('hotelList').innerHTML = '';
            
            // Более точные границы Самарской области
            const samaraBounds = [
                [52.3, 48.4], // юго-запад
                [54.2, 51.6]  // северо-восток
            ];
            
            // Используем поиск через геокодер
            const searchQuery = 'гостиница';
            const boundedBy = samaraBounds.map(coord => coord.reverse()).join(',');
            
            // Поиск организаций в границах области
            ymaps.geocode(searchQuery, {
                boundedBy: boundedBy,
                results: 50, // ограничиваем количество результатов
                kind: 'house' // ищем здания
            }).then(function(res) {
                const geoObjects = res.geoObjects;
                statusElement.textContent = `Найдено объектов: ${geoObjects.getLength()}`;
                
                if (geoObjects.getLength() === 0) {
                    statusElement.textContent += " (попробуйте изменить параметры поиска)";
                    return;
                }

                const features = [];
                geoObjects.each(function(geoObject, index) {
                    const coordinates = geoObject.geometry.getCoordinates();
                    const properties = geoObject.properties.getAll();
                    
                    // Фильтруем только гостиницы (по названию)
                    if (!properties.name || !properties.name.toLowerCase().includes('гостин')) {
                        return;
                    }
                    
                    addHotelToList(properties, coordinates, index);
                    
                    features.push({
                        type: 'Feature',
                        id: index,
                        geometry: {
                            type: 'Point',
                            coordinates: coordinates
                        },
                        properties: {
                            hintContent: properties.name || 'Гостиница',
                            balloonContent: [
                                '<b>' + (properties.name || 'Гостиница') + '</b>',
                                properties.description || '',
                                properties.address || ''
                            ].filter(Boolean).join('<br>')
                        }
                    });
                });
                
                if (features.length === 0) {
                    statusElement.textContent = "Гостиницы не найдены";
                    return;
                }
                
                objectManager.add({
                    type: 'FeatureCollection',
                    features: features
                });
                
                map.setBounds(geoObjects.getBounds(), { checkZoomRange: true });
                
            }).catch(function(error) {
                statusElement.textContent = "Ошибка при поиске: " + error.message;
                console.error(error);
            });
        }
        
        function addHotelToList(properties, coordinates, index) {
            const listElement = document.getElementById('hotelList');
            const item = document.createElement('div');
            item.className = 'hotel-item';
            item.dataset.index = index;
            
            const name = properties.name || 'Гостиница без названия';
            const address = properties.address || 'Адрес не указан';
            
            item.innerHTML = `
                <h3>${name}</h3>
                <p>${address}</p>
            `;
            
            item.addEventListener('click', function() {
                objectManager.objects.balloon.open(index);
                map.setCenter(coordinates, { duration: 300 });
            });
            
            listElement.appendChild(item);
        }
    </script>
</body>
</html>
